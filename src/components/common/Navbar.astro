---
import Logo from "../../assets/logo.png";
import Image from "astro/components/Image.astro";
import CommonButton from "./CommonButton.astro";
---

<aside id="wrapper-sidebar">
  <div
    id="sidebar"
    class="fixed top-0 left-0 z-50 h-screen w-[65px] bg-[#f8f8f8] xl:w-[88px]"
  >
    <svg
      width="13"
      height="52"
      viewBox="0 0 13 52"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      class="mx-auto mt-4"
    >
      <line x1="0.5" y1="0" x2="0.5" y2="52" stroke="#000047"></line>
      <line x1="12.5" y1="0" x2="12.5" y2="52" stroke="#000047"></line>
    </svg>
    <div class="absolute right-2 h-[95%] w-[1px] bg-[#DADEFF]"></div>
    <div class="absolute top-4 right-2 h-[10%] w-[1.5px] bg-[#606DD1]"></div>
  </div>
</aside>

<nav
  class="fixed top-0 right-0 left-[65px] z-50 flex w-[calc(100vw-65px)] xl:left-[88px] xl:w-[calc(100vw-88px)]"
>
  <div class="flex w-full justify-between">
    <div
      id="nav-container"
      class="flex items-center bg-[#f8f8f8] px-3 py-1.5 shadow-xs transition-all duration-300 md:px-4 md:py-2 lg:px-4 lg:py-2"
    >
      <div
        class="flex max-w-[100px] min-w-[100px] items-center md:mr-6 lg:mr-8 xl:mr-10 xl:min-w-[120px] 2xl:mr-12 2xl:min-w-[170px]"
      >
        <Image
          src={Logo}
          alt="Nixxon Tech Logo"
          class="h-auto w-full max-w-[100px] min-w-[100px] xl:min-w-[120px] 2xl:min-w-[170px]"
        />
      </div>

      <ul
        class="3xl:text-xl hidden items-center gap-x-4 text-sm font-medium text-nowrap text-[#000000] md:flex md:gap-x-6 md:text-base lg:gap-x-8 lg:text-[15px] xl:gap-x-10 2xl:gap-x-12 2xl:text-lg"
      >
        <li>
          <a
            href="/"
            class="3xl:px-4 3xl:py-3 rounded-full bg-[#9D7EFF] px-2.5 py-1.5 text-sm text-white md:text-base xl:px-3 xl:py-2"
            >Home</a
          >
        </li>
        <li><a href="/about" class="hover:text-black">About Us</a></li>
        <li class="group relative">
          <button class="flex items-center space-x-1 hover:text-black">
            <span>Services</span>
            <svg
              class="h-3.5 w-3.5 md:h-4 md:w-4"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <ul
            class="absolute left-0 mt-2 hidden w-36 rounded-lg border bg-[#f8f8f8] text-sm shadow-lg group-hover:block md:w-40 md:text-base"
          >
            <li>
              <a
                href="/services/web"
                class="block px-3 py-1.5 hover:bg-gray-100 md:px-4 md:py-2"
                >Web Design</a
              >
            </li>
            <li>
              <a
                href="/services/seo"
                class="block px-3 py-1.5 hover:bg-gray-100 md:px-4 md:py-2"
                >SEO</a
              >
            </li>
            <li>
              <a
                href="/services/branding"
                class="block px-3 py-1.5 hover:bg-gray-100 md:px-4 md:py-2"
                >Branding</a
              >
            </li>
          </ul>
        </li>
        <li><a href="/portfolio" class="hover:text-black">Portfolio</a></li>
      </ul>

      <div
        id="inner-button"
        class="pointer-events-none my-auto ml-auto opacity-0 transition-opacity duration-300"
      >
        <CommonButton
          className="my-auto mr-2 px-2.5 py-1.5 text-sm md:mr-4 xl:px-4 xl:py-2 xl:text-base"
        >
          Book A discovery call
        </CommonButton>
      </div>
    </div>

    <div id="outer-button" class="my-auto transition-opacity duration-300">
      <CommonButton
        className="my-4  mr-2 px-2.5 py-1.5 text-sm md:mr-8 md:px-3 md:py-2 md:text-base lg:px-4 xl:px-6"
      >
        Book A discovery call
      </CommonButton>
    </div>
  </div>
</nav>

<script>
  import { gsap, ScrollTrigger } from "../../utils/gsapUtils.js";

  document.addEventListener("DOMContentLoaded", () => {
    const navContainer = document.getElementById("nav-container");
    const innerButton = document.getElementById("inner-button");
    const outerButton = document.getElementById("outer-button");

    if (!navContainer || !innerButton || !outerButton) return;

    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: ".hero-section",
        start: "bottom 5%",
        end: "bottom top",
        scrub: 0.01,
        toggleActions: "play none none reverse",
      },
    });

    tl.fromTo(
      navContainer,
      {
        width: "60%",
        borderTopRightRadius: "-50px",
        borderBottomRightRadius: "1.5rem",
      },
      {
        width: "100%",
        borderRadius: 0,
        ease: "power2.inOut",
        duration: 0.3,
        borderBottom: "1px",
        borderBottomColor: "black",
      },
    )
      .fromTo(
        innerButton,
        { display: "none", opacity: 0, pointerEvents: "none" },
        {
          opacity: 1,
          pointerEvents: "auto",
          duration: 0.2,
          marginTop: "1rem",
          marginBottom: "1rem",
          display: "block",
        },
      )
      .fromTo(
        outerButton,
        { opacity: 1, pointerEvents: "auto", display: "block" },
        { opacity: 0, pointerEvents: "none", display: "none" },
      );

    const sidebar = document.getElementById("wrapper-sidebar");
    const nav = document.querySelector("nav");
    if (sidebar) {
      ScrollTrigger.create({
        trigger: sidebar,
        start: "top top",
        endTrigger: ".our-services",
        end: "bottom top",
        pin: true,
        anticipatePin: 1,
        onLeave: () => {
          // Detect if screen is xl or above (using 1280px as Tailwind's xl)
          const isXL = window.innerWidth >= 1280;
          nav.style.left = isXL ? "0" : "0";
          nav.style.width = "100vw";
          nav.classList.remove(
            isXL ? "left-[88px]" : "left-[65px]",
            isXL ? "w-[calc(100vw-88px)]" : "w-[calc(100vw-65px)]",
          );
          nav.classList.add("w-full");
          sidebar.style.display = "none";
        },
        onEnterBack: () => {
          const isXL = window.innerWidth >= 1280;
          nav.style.left = isXL ? "88px" : "65px";
          nav.style.width = "";
          nav.classList.remove("w-full");
          nav.classList.add(
            isXL ? "left-[88px]" : "left-[65px]",
            isXL ? "w-[calc(100vw-88px)]" : "w-[calc(100vw-65px)]",
          );
          sidebar.style.display = "";
        },
      });
    }
  });
</script>
